<?xml version="1.0" encoding="utf-8"?>
<!-- Copyright 2014 Google Inc. All Rights Reserved -->
<configuration
    description="Downloads a clockwork device and CTS build, flashes device, pairs with a companion device and then runs a CTS plan on device">
    <include name="google/cts/cts-device" />
    <option name="google-device-setup:set-test-harness" value="false" />
    <!-- allocates a companion device -->
    <target_preparer class="com.google.android.tradefed.targetprep.clockwork.ClockworkCompanionAllocator" />
    <!-- install dependency pieces for pairing onto clockwork -->
    <target_preparer class="com.android.tradefed.targetprep.TestAppInstallSetup">
        <option name="test-file-name" value="BluetoothTests.apk" />
        <option name="test-file-name" value="GeppettoClockwork.apk" />
    </target_preparer>
    <!-- install dependency pieces for pairing onto companion -->
    <target_preparer class="com.google.android.tradefed.targetprep.clockwork.ClockworkCompanionPreparer">
        <option name="sideload-apks-path" value="/google/data/ro/teams/tradefed/testdata/clockwork" />
        <option name="apk-name-filter" value="GmsCore\.apk" />
        <option name="apk-name-filter" value="Velvet\.apk" />
        <option name="apk-name-filter" value="ClockworkCompanionGoogle\.apk" />
        <option name="apk-name-filter" value="BluetoothTests\.apk" />
    </target_preparer>
    <!-- install dependency pieces for pairing onto companion -->
    <target_preparer class="com.android.tradefed.targetprep.companion.CompanionTestAppInstallSetup">
        <option name="test-file-name" value="GeppettoClockwork.apk" />
        <!-- considered adding uninstall code via ITargetCleaner to this target_preparer instead of
        using -d as an installation argument but this is the simpler solution because uninstallation
        requires a package name (in addition to the file name already required for installation) -->
        <option name="install-arg" value="-d" />
    </target_preparer>
    <!-- prep clockwork device with some commands -->
    <target_preparer class="com.android.tradefed.targetprep.RunCommandTargetPreparer">
        <!-- Disable WiFi opt-in dialog -->
        <option name="run-command" value="pm disable com.google.android.wearable.app/com.google.android.clockwork.home.cloudsync.CloudSyncOptInService" />
        <option name="run-command" value="am startservice -a com.google.android.clockwork.action.TUTORIAL_SKIP" />
    </target_preparer>
    <!-- one shot pairing "stress" to pair the devices -->
    <test class="com.google.android.clockwork.PairingStress">
        <option name="one-shot" value="true" />
    </test>
</configuration>
